<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400&display=swap" rel="stylesheet">

<link rel="stylesheet" href="stylesheets/fonts/icomoon/style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="stylesheets/css/owl.carousel.min.css">
<link rel="stylesheet" href="stylesheets/css/bootstrap.min.css">
<link rel="stylesheet" href="stylesheets/css/style.css">


<link rel="stylesheet" type="text/css" href="/DataTables/datatables.css">

<script type="text/javascript" charset="utf8" src="/DataTables/datatables.js"></script>

<link rel="icon" href="https://64.media.tumblr.com/bafc236f8913370429d52ee13d363ff9/tumblr_nkm7541saS1r6wywso1_500.gifv">
<title>Edit Booking</title>
</head>

<nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top justify-content-between">
  <div class="navbar-nav">
  <a href="/studentDash" class="nav-link nav-item navbar-brand" id="test"><i class="fa fa-fw fa-home"></i> Home</a>
</div>


<div class="btn-group open">
  <a class="btn btn-primary" href="#"><i class="fa fa-user fa-fw"></i> <%= name%></a>
  <a class="btn btn-primary dropdown-toggle" data-toggle="dropdown" href="#">
  </a>
  <ul class="dropdown-menu">
    <li><a href="/logout"><i class="fa fa-sign-out "></i> Logout</a></li>
  </ul>
</div>

</nav>

</nav>


<body>
<script>
localStorage.setItem('roomTime-ID', "")
bookDate = localStorage.getItem('date-ID').value
bookID = localStorage.getItem('room-ID').value
newTime = ""
  function buttonSelecter() {

        var y = document.getElementById(event.target.id).id;
        var x = document.getElementById(event.target.id);
        newTime = y.substr(y.indexOf('&')+1);
        g = " ";

        let elems = document.getElementsByClassName("button");

        if (x.style.backgroundColor == 'pink'){
          g = document.getElementById(y).value
          document.getElementById("newTime").innerHTML = "Change your timeslot from <strong><%=t%></strong> to "+"<strong>"+newTime+"</strong>";
          document.getElementById("newTimeslot").value = newTime
          document.getElementById("editBooking").value = "true"

          for(let i = 0; i < elems.length; i++){
            elems[i].style.backgroundColor = 'pink'}
          x.style.backgroundColor = 'red';
        } else {
            x.style.backgroundColor = 'pink';
            y = '';
            document.getElementById("newTime").innerHTML = ""
            document.getElementById("newTimeslot").value = ""
            document.getElementById("editBooking").value = "false"
        }
        localStorage.setItem('roomTime-ID',y)
      }

</script>
  <script src="stylesheets/js/jquery-3.3.1.min.js"></script>
  <script src="stylesheets/js/popper.min.js"></script>
  <script src="stylesheets/js/bootstrap.min.js"></script>
  <script src="stylesheets/js/main.js"></script>

<div class='container-fluid'>
<div class='row vh-100'>
  <div class='col-2 h-100 bg-light'>
    <div style="margin-top:25%;">
      <nav class="nav nav-pills nav-fill flex-column">
      <a class="nav-link" href="/studentDash">Dashboard</a>
      <a class="nav-link active" href="#">Room Booking</a>
      <a class="nav-link disabled" href="#">Consult a Lecturer</a>
      <a class="nav-link disabled" href="#">Timetable</a>
    </nav>
    </div>
  </div>

    <div class='col-10 border'>
      <div style="margin-top:5%;">
        <div class='row justify-content-start'>
          <div class='col-2'>
                            <h4>Change timeslot</h4>
            <div class="form-group">
              <label for="selectDate">Date</label>
              <input
              type="date"
              class="form-control"
              name="selectDate"
              id="selectDate"
              value= <%=d%>
              readonly
              />
            </div>
          </div>
          <div class='col-2' style="margin-top:2%">
        </div>
      </div>
              <div class='col'>
                <table id='tableTry2' class="table table-bordered" style="width:100%">
                <thead class="thead-dark">
      <tr>
        <th style="width:100px" class="text-center">roomID</th>
        <th style="width:700px" class="text-center">Slots</th>
      </tr>
    </thead>
    <tbody>
    <script>
    </script>
    <!--maybe style this nicely-->
    Timeslots for roomID <b><%=r%></b> on <b><%=d%></b>
<%  txt = "";

              let selectDate = d
              time = "";
              filterRoom = roomIDs1.filter(function(test){
                return test.roomID == r;
              });
              filterBooked = booking1.filter(function(test){
                return test.Date == d;
              });
              filterBookedSlot = filterBooked.filter(function(test){
                return test.roomID == r;
              });



              %>
                  <tr>
                    <th class="text-center align-middle">
                      <%= r%>
                      </th>                  <th>
                    <%
                    array = []
                    for(b in filterBookedSlot){
                      array.push(filterBookedSlot[b]['Timeslot'])
                    }
                    for(y in filterRoom[0]['timeslots']) {
                      if(array.includes(filterRoom[0]['timeslots'][y].substring(4,15))){%>
                      <button id="<%=filterRoom[0]['roomID']+"\&"+filterRoom[0]['timeslots'][y].substring(4,15)%>" value="<%=filterRoom[0]['price']+"\&"+filterRoom['promotionalCode']%>" disabled onclick="buttonSelecter()" class="btn btn-secondary" ><%=filterRoom[0]['timeslots'][y].substring(4,15)%></button>
                      <%} else {%>
                        <button id="<%=filterRoom[0]['roomID']+"\&"+filterRoom[0]['timeslots'][y].substring(4,15)%>" value="<%=filterRoom[0]['price']+"\&"+filterRoom['promotionalCode']%>" onclick="buttonSelecter()" class="button" ><%=filterRoom[0]['timeslots'][y].substring(4,15)%></button>
                      <%}};%>
                      </th>

</tbody>
</table>
<p id="newTime"></p>
<form action="/editbooking" method="post">
<input type="text" id="selectDate" name="selectDate" value=<%=d%>>
<input type="text" id="selectRoomID" name="selectRoomID" value=<%=r%>>
<input type="text" id="selectTimeslot" name="selectTimeslot" value=<%=t%>>
<input type="text" id="newTimeslot" name="newTimeslot">
<input type="text" id="editBooking" name="editBooking">
<a href="#"><button class="dt-button" onclick="getBook()"  type="submit"><span>Modify Booking</span></button></a>
</form>
          </div>
        </div>
</div>
</div>
<!-- TABLE -->
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.1/css/dataTables.bootstrap5.min.css">

<script type="text/javascript" language="javascript" src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script type="text/javascript" language="javascript" src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" language="javascript" src="https://cdn.datatables.net/1.11.1/js/dataTables.bootstrap5.min.js"></script>
<script>
function getBook(){
  if (document.getElementById("newTime").innerHTML == ""){
    alert("Please select a timeslot!")
  } else {

  }
}

</script>
<style>
  .button {
background-color: pink;
border: none;
color: black;
padding: 10px 20px;
text-align: center;
text-decoration: none;
display: inline-block;
margin: 4px 2px;
cursor: pointer;
border-radius: 16px;
}
  </style>
</body>
