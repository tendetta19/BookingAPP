<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400&display=swap" rel="stylesheet">

<link rel="stylesheet" href="stylesheets/fonts/icomoon/style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="stylesheets/css/owl.carousel.min.css">
<link rel="stylesheet" href="stylesheets/css/bootstrap.min.css">
<link rel="stylesheet" href="stylesheets/css/style.css">


<link rel="stylesheet" type="text/css" href="/DataTables/datatables.css">

<script type="text/javascript" charset="utf8" src="/DataTables/datatables.js"></script>

<link rel="icon" href="https://64.media.tumblr.com/bafc236f8913370429d52ee13d363ff9/tumblr_nkm7541saS1r6wywso1_500.gifv">
<title>Room Booking</title>
</head>

<nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top justify-content-between">
  <div class="navbar-nav">
  <a href="/studentDash" class="nav-link nav-item navbar-brand" id="test"><i class="fa fa-fw fa-home"></i> Home</a>
</div>


<div class="btn-group open">
  <a class="btn btn-primary" href="#"><i class="fa fa-user fa-fw"></i></a>
  <a class="btn btn-primary dropdown-toggle" data-toggle="dropdown" href="#">
  </a>
  <ul class="dropdown-menu">
    <li><a href="/settings"><i class="fa fa-cog "></i> Settings</a></li>
    <li><a href="/logout"><i class="fa fa-sign-out "></i> Logout</a></li>
  </ul>
</div>

</nav>

</nav>


<body>
<script>  function getRooms(){
  selectDate = new Date(document.getElementById("selectDate").value)
  selectCapacity1 = document.getElementById("selectCapacity").value

  localStorage.setItem('capacity-ID',selectCapacity)
  alert(c)
  p =  roomIDs1[0]['launchstartdate'] 
    


  for(x in p) {
  start = new Date(roomIDs1[x]['launchstartdate'] );
  end = new Date(roomIDs1[x]['launchenddate']);
  if (start.getTime() <= selectDate.getTime() &&
  selectDate.getTime() <= end.getTime() &&
   roomIDs1[x]['roomCapacity'] >= selectCapacity){
    console.log(i)
  }
}
}</script>
  <script src="stylesheets/js/jquery-3.3.1.min.js"></script>
  <script src="stylesheets/js/popper.min.js"></script>
  <script src="stylesheets/js/bootstrap.min.js"></script>
  <script src="stylesheets/js/main.js"></script>

<div class='container-fluid'>
<div class='row vh-100'>
  <div class='col-2 h-100 bg-light'>
    <div style="margin-top:25%;">
      <nav class="nav nav-pills nav-fill flex-column">
      <a class="nav-link" href="/studentDash">Dashboard</a>
      <a class="nav-link active" href="#">Room Booking</a>
      <a class="nav-link disabled" href="#">Consult a Lecturer</a>
      <a class="nav-link disabled" href="#">Timetable</a>
    </nav>
    </div>
  </div>
          
    <div class='col-10 border'>
      <div style="margin-top:5%;">
        <div class='row justify-content-start'>
          <div class='col-2'>
            <form action="/studentDash" method="post">
            <div class="form-group">
              <label for="selectDate">Date</label>
              <input
              type="date"
              class="form-control"
              name="selectDate"
              id="selectDate"
              min="2022-01-01"
              max="2099-12-31"
              value=<%= d %>
              />
            </div>
          </div>
            <div class='col-2'>
              <div class="form-group">
                <label for="selectCapacity">Capacity</label>
                <input
                type="string"
                class="form-control"
                name="selectCapacity"
                placeholder="Number of people"
                id="selectCapacity"
                value=<%= c %>
                />
            </div>
          </div>
          <div class='col-2' style="margin-top:2%">
            <button class="dt-button" id='getAvailable' onclick='getRooms()' type="submit"><span>Show available rooms</span></button></form>
        </div>
      </div>
            <p>
              <div class='col'>
                <table id='tableTry2' class="table table-bordered" style="width:100%">
                <thead>
      <tr>
        <th width=100>roomID</th>
        <th width=700>Slots</th>
      </tr>
    </thead>
    <tbody>
    <script>
    </script>

              Hello Capcity is <%= c%> <br> Selected Date is <%=d%>
<%  txt = "";

              let selectDate = new Date(d);
              let selectCapacity = c
              time = "";


              for(x in roomIDs1) {
                start = new Date(roomIDs1[x]['launchstartdate']);
                end = new Date(roomIDs1[x]['launchenddate']);

                if (start.getTime() <= selectDate.getTime() &&
                selectDate.getTime() <= end.getTime() &&
                roomIDs1[x]['roomCapacity'] >= selectCapacity) {%>
                  <tr>
                    <th>
                      <%= roomIDs1[x]['roomID']%>
                      </th>
                  <th>
                    <% for(y in roomIDs1[x]['timeslots']) {%>
                      <button id="<%=roomIDs1[x]['roomID']+"\*"+roomIDs1[x]['timeslots'][y].substring(4,15)%>" onclick="myFunction()" class="button" ><%=roomIDs1[x]['timeslots'][y].substring(4,15)%></button>
                      <%;}%>
                      </th>
                      <%} else{txt += 'NIL, '}}%>
</tbody>
</table>
</p>
<a href="/payment"><button class="dt-button" id='getBookingDeets'  type="button"><span>Next</span></button></a>
<p><%= txt%></p>
          </div>
          <div class='col'>
            <table id='tableTry' class="table table-bordered" style="width:100%">
            <thead>
  <tr>
    <th 'width=100%'>roomID</th>
    <th 'width=100%'>Slots</th>
  </tr>
</thead>
<tbody>
<%roomIDs1.forEach(rooms => {%>
    <tr>
      <th><%= rooms.roomID %></th>
      <th><%= rooms.timeslots %></th>
</tr>
<%})%>
</tbody>
</table>
<p id='demo'></p>

          </div>
        </div>
</div>
</div>
<!-- TABLE -->
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.1/css/dataTables.bootstrap5.min.css">

<script type="text/javascript" language="javascript" src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script type="text/javascript" language="javascript" src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" language="javascript" src="https://cdn.datatables.net/1.11.1/js/dataTables.bootstrap5.min.js"></script>
<script>
function getDate() {
  currentDate = document.getElementById('selectDate')
}
$(function() {
   $("#tableTry").dataTable({
       "iDisplayLength": 1,
       "aLengthMenu": [[10, 25, 50, 100,  -1], [10, 25, 50, 100, "All"]]
      });
  });


</script>
<style>
  .button {
background-color: pink;
border: none;
color: black;
padding: 10px 20px;
text-align: center;
text-decoration: none;
display: inline-block;
margin: 4px 2px;
cursor: pointer;
border-radius: 16px;
}
  </style>
</body>